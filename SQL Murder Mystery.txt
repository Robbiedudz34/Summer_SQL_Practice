-- You vaguely remember that the crime was a ​murder​ 
-- that occurred sometime on ​Jan.15, 2018​ and that it took place in ​SQL City​. Start by 
-- retrieving the corresponding crime scene report from the police department’s database.

SELECT *
FROM crime_scene_report
WHERE type = 'murder'
AND city = 'SQL City'
AND date = 20180115

--Security footage shows that there were 2 witnesses. 
--The first witness lives at the last house on "Northwestern Dr". 
--The second witness, named Annabel, lives somewhere on "Franklin Ave".

SELECT *
FROM person
WHERE address_street_name = 'Franklin Ave'
AND name LIKE 'Annabel%'
limit 100

-- 14887	Morty Schapiro	118009	4919	Northwestern Dr	111564949
-- 16371	Annabel Miller	490173	103	Franklin Ave	318771143

SELECT *
FROM interview
WHERE person_id IN (14887, 16371)

-- FROM 14887
--I heard a gunshot and then saw a man run out. He had a "Get Fit Now Gym" bag. 
--The membership number on the bag started with "48Z". 
--Only gold members have those bags. 
--The man got into a car with a plate that included "H42W".

-- FROM 16371
--I saw the murder happen, and I recognized the killer 
-- from my gym when I was working out last week on January the 9th.

SELECT *
FROM get_fit_now_member
WHERE membership_status = 'gold'
AND id LIKE '48Z%'
LIMIT 100

--48Z7A	28819	Joe Germuska	20160305	gold
--48Z55	67318	Jeremy Bowers	20160101	gold

SELECT *
FROM get_fit_now_check_in
WHERE check_in_date = 20180109
AND membership_id LIKE '48z%'
LIMIT 100

--48Z7A	20180109	1600	1730
--48Z55	20180109	1530	1700

SELECT *
FROM person AS p
JOIN drivers_license AS d
	ON p.license_id = d.id
WHERE p.id IN (28819, 67318)

-- 67318	Jeremy Bowers	423327	530	Washington Pl, Apt 3A	871539279	
-- 423327	30	70	brown	brown	male	0H42W2	Chevrolet	Spark LS

INSERT INTO solution VALUES (1, 'Jeremy Bowers');
        
        SELECT value FROM solution;

--Congrats, you found the murderer! But wait, there's more... 
-- If you think you're up for a challenge, try querying the interview transcript
--of the murderer to find the real villain behind this crime. 
--If you feel especially confident in your SQL skills, try to complete this
--final step with no more than 2 queries. 
--Use this same INSERT statement with your new suspect to check your answer.

SELECT *
FROM interview
WHERE person_id = 67318

-- 67318	I was hired by a woman with a lot of money. I don't know her name 
--but I know she's around 5'5" (65") or 5'7" (67"). She has red hair and she drives 
--a Tesla Model S. 
--I know that she attended the SQL Symphony Concert 3 times in December 2017.


SELECT name
FROM drivers_license as d
INNER JOIN person as p on d.id = p.license_id
INNER JOIN facebook_event_checkin as fb on p.id = fb.person_id
WHERE hair_color = 'red'
AND gender = 'female'
AND LOWER(car_make) = 'tesla'
AND lower(car_model) = 'model s'
AND height BETWEEN 65 AND 67
GROUP BY event_name
HAVING COUNT ('SQL Symphony Concert') = 3
LIMIT 10

              
INSERT INTO solution VALUES (1, 'Miranda Priestly');
        
        SELECT value FROM solution;

Congrats, you found the brains behind the murder! Everyone in SQL City hails you as the greatest SQL detective of all time. Time to break out the champagne!